---

- name: mssql credential
  vars:
    url_host: "https://{{ tower_host }}"
    url_api: "/api/v2/credentials/"
    user: "{{ tower_username }}"
    password: "{{ tower_password }}"
    validate_certs: "{{ tower_verify_ssl|bool }}"
    headers:
      Content-Type: "application/json"
      Accept: "application/json"
    body:
      name: mssql
      description: Microsoft SQL server credential
      credential_type: mssql
      inputs:
        mssql_username: "{{ mssql_username }}"
        mssql_password: "{{ mssql_password }}"
    body_format: "{{ tower_config.format }}"
  no_log: True

- name: create mssql credential
  uri:
    method: POST
    url: "{{ url_host }}{{ url_api }}"
    user: "{{ user }}"
    password: "{{ password }}"
    validate_certs: "{{ validate_certs }}"
    headers: "{{ headers }}"
    body_format: "{{ body_format }}"
  register: reg_credential_type
  no_log: True
  ignore_errors: yes